<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css"> 
    <link rel="icon" type="image/x-icon" href="./icons/fisioVR02.ico">

    <nav>
        <img src="icons/fisioVR02.jpeg" style="width: 80px; height: 80px;">
        <ul class="menu">
            <!--<li><a href="" id="fecharJanela">Fechar janela</a></li>-->
        </ul>
    </nav>
    <title>Exercicios</title>
</head>

<body>
    <main class="main">
        <div class="content">
            <div class="container mt-4" style="margin-left: 20px; margin-top: 20px; margin-bottom: 20px; width: 95%">
                <form class="card-body" id="form">
                    <select name="exercicio" id="exercicio" required="required">
                        <option style="height: 50%;"  value="Desenvolvimento de Ombros" src="">Desenvolvimento de Ombros</option>
                        <option style="height: 50%;"  value="Elevação Lateral de Ombros" src="">Elevação Lateral de Ombros</option>
                        <option style="height: 50%;"  value="Estocada Lateral" src="">Estocada Lateral</option>
                        <option style="height: 50%;"  value="Agachamento" src="">Agachamento</option>
                        <option style="height: 50%;"  value="Agachamento Sumô" src="">Agachamento Sumô</option>
                        <option style="height: 50%;"  value="Elevação Lateral de Pernas" src="">Elevação Lateral de Pernas</option>
                    </select>
                    <div>
                        <label>Número de Séries:</label>
                        <input type="text" id="sets" value="1">
                    </div>
                    <div>
                        <label>Número de Repetições:</label>
                        <input type="text" id="reps" value="5">
                    </div>
                    <div>
                        <label>Tempo de Descanso:</label>
                        <input type="text" id="rest" value="3">
                    </div>
                    <div>
                        <label>Ângulos Concêntricos:</label>
                        <input type="text" id="concentric" value="165,165">
                        <span id="membros-concentricos">Cotovelo, Ombro</span>
                    </div>
                    <br>
                    <div>
                        <label>Ângulos Excêntricos:</label>
                        <input type="text" id="excentric" value="90,90">
                        <span id="membros-excentricos">Cotovelo, Ombro</span>
                    </div>
                    <button class="button_1" id="start">Iniciar</button>
                </form>
            </div>
            <div class="show-gif">
                <img id="gif" src="./icons/gifs/desenvolvimento-para-ombros-com-halteres.webp" alt="" style="border-radius: 20px; border-color: #8b8b8b;">
            </div>
        </div>
    </main>
    <footer class="rodape"></footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>   
    <script>
        document.getElementById('start').addEventListener("click", function(event){
            event.preventDefault();

            const concentric = document.getElementById('concentric');
            const excentric = document.getElementById('excentric');
            let element = exercicios.find(exercicio => exercicio.nome === document.getElementById('exercicio').value);

            var anglesCon = concentric.value.toString().split(",");
            var anglesExc = excentric.value.toString().split(",");
            
            if(anglesCon.length === Object.keys(element.angulos_concentricos).length && anglesExc.length === Object.keys(element.angulos_excentricos).length){
                for(var i=0; i<anglesCon.length; i++){
                    element.angulos_concentricos[Object.keys(element.angulos_concentricos)[i]] = anglesCon[i];
                    element.angulos_excentricos[Object.keys(element.angulos_excentricos)[i]] = anglesExc[i];
                }

                var frm = document.getElementById('form');
                var vname = document.getElementById('exercicio').value;
                var vsets = parseInt(document.getElementById('sets').value);
                var vreps = parseInt(document.getElementById('reps').value);
                var vrest = parseInt(document.getElementById('rest').value);

                var vconcentric = JSON.parse(JSON.stringify(element.angulos_concentricos));
                var vexcentric = JSON.parse(JSON.stringify(element.angulos_excentricos));

                let exercicio = {
                    name: vname,
                    sets: vsets,
                    leftReps: vreps,
                    rightReps: vreps,
                    rest: vrest,
                    concentric: vconcentric,
                    eccentric: vexcentric,
                    margin: 10
                }

                var criptExe = btoa(JSON.stringify(exercicio));
                var valid = 0;

                for(var i=0; i<criptExe.length; i++){
                    valid += criptExe[i].charCodeAt(0);
                }

                open(`https://avrgroup.github.io/FisioVR/?exe=${criptExe}&eval=${valid}`);
            }
            else{
                open(`https://avrgroup.github.io/FisioVR/error.html`);
            }
        });

        const exercicios = [
            {
                nome: "Elevação Lateral de Ombros",
                angulos_concentricos: {rightElbow:175, rightShoulder:90},
                angulos_excentricos: {rightElbow:175, rightShoulder:8},
                caminho_demonstracao: './icons/gifs/ombros-elevacao-lateral-de-ombros.webp',
                articulacoes: 'Cotovelo, Ombro'
            },
            {
                nome: "Desenvolvimento de Ombros",
                angulos_concentricos: {rightElbow:165,rightShoulder:165},
                angulos_excentricos: {rightElbow:90,rightShoulder:90},
                caminho_demonstracao: './icons/gifs/desenvolvimento-para-ombros-com-halteres.webp',
                articulacoes: 'Cotovelo, Ombro'
            },
            {
                nome: "Estocada Lateral",
                angulos_concentricos: {rightHip:33,rightKnee:115,leftHip:30,leftKnee:170},
                angulos_excentricos: {rightHip:20,rightKnee:165,leftHip:20,leftKnee:165},
                caminho_demonstracao: './icons/gifs/pernas-agachamento-lateral-gif.webp',
                articulacoes: 'Quadril Direito, Joelho Direito, Quadril Esquerdo, Joelho Esquerdo'
            },
            {
                nome: "Agachamento",
                angulos_concentricos: {rightKnee:115,rightHip:45},
                angulos_excentricos: {rightKnee:165,rightHip:15},
                caminho_demonstracao: './icons/gifs/agachamento.webp',
                articulacoes: 'Joelho, Quadril'
            },
            {
                nome: "Agachamento Sumô",
                angulos_concentricos: {rightKnee:150,rightHip:15},
                angulos_excentricos: {rightKnee:180,rightHip:15},
                caminho_demonstracao: './icons/gifs/agachamento-sumo.webp',
                articulacoes: 'Joelho, Quadril'
            },
            {
                nome: "Elevação Lateral de Pernas",
                angulos_concentricos: {rightHip:45},
                angulos_excentricos: {rightHip:15},
                caminho_demonstracao: './icons/gifs/elevacao-lateral-de-pernas.webp',
                articulacoes: 'Quadril'
            }
        ]

        document.getElementById('exercicio').addEventListener('change', function handleChange(event){
            const img  = document.getElementById('gif');
            const concentric = document.getElementById('concentric');
            const excentric = document.getElementById('excentric');

            if (event.target.value === ''){
                img.src = '';
            }
            else {
                let element = exercicios.find(exercicio => exercicio.nome === event.target.value);
                img.src = element.caminho_demonstracao;
                concentric.value = Object.values(element.angulos_concentricos).join(',');
                excentric.value = Object.values(element.angulos_excentricos).join(',');
                document.getElementById("membros-concentricos").innerText  = element.articulacoes;
                document.getElementById("membros-excentricos").innerText  = element.articulacoes;

            }
        });
    </script>
</body>

</html>